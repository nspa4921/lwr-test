class LazyMapToList{constructor(e){if(this._lazyMap=new Map,void 0!==e){if("number"==typeof e&&e>0)return void(this._maxSize=Math.ceil(e));throw new Error("maxSize must be a positive number")}}get maxSize(){return this._maxSize}get size(){return this._lazyMap.size}push(e,t){let n=this._lazyMap.get(e);if(!n){if(void 0!==this.maxSize&&this.size===this.maxSize)return!1;n=new Array,this._lazyMap.set(e,n)}return n.push(t),!0}getMessages(e,t){const n=this._lazyMap.get(e);return t&&this._lazyMap.has(e)&&this._lazyMap.set(e,[]),n||[]}getAllMessages(e){const t=new Map;for(const[n,r]of this._lazyMap.entries())r.length&&t.set(n,this.getMessages(n,e));return t}extractMessages(e){return this.getMessages(e,!0)}extractAllMessages(){return this.getAllMessages(!0)}get totalItemCount(){let e=0;for(const t of this._lazyMap.values())e+=t.length;return e}}class Utility{constructor(){this.notImplemented="Method not implemented.";const e="undefined"!=typeof performance;e?performance.timeOrigin?this._timeOrigin=performance.timeOrigin:performance.timing&&performance.timing.navigationStart?this._timeOrigin=performance.timing.navigationStart:this._timeOrigin=Date.now():this._timeOrigin=Date.now();const t=this._timeOrigin;e&&"function"==typeof performance.now?(this.perfNow=performance.now.bind(performance),this.time=()=>{const e=this.perfNow();return{tsNow:t+e,perfNow:e}}):(this.perfNow=()=>Date.now()-t,this.time=()=>{const e=this.perfNow();return{tsNow:Date.now(),perfNow:e}})}get isProduction(){return Utility._isProduction}markProduction(){Utility._isProduction=!0}checkArgument(e,t){if("string"==typeof t)return typeof e===t;if("function"==typeof t)return e instanceof t;if(Array.isArray(t))return t.some((t=>this.checkArgument(e,t)));throw new Error(`Invalid argKind ${t}`)}requireArgument(e,t,n){let r=null==e||""===e;const i=void 0!==n;if(!r&&i&&(r=!this.checkArgument(e,n)),r)throw new Error(`${t} argument is required${i?" and must be of a supported type.":"."}`)}requireArgumentIfDefined(e,t,n){if(void 0===e)return!1;if(null===e||""===e||!this.checkArgument(e,n))throw new Error(`${t} argument, if defined, must be of a supported type.`);return!0}checkForDenyListedValues(e,t,n){if(n.some((t=>e===t)))throw new Error(`The value ${e} isn't allowed for ${t} argument.`)}checkForReservedCharacters(e,t,n){if(e&&n.some((t=>e.indexOf(t)>=0)))throw new Error(`The argument ${t} isn't allowed to contain characters from ['${n.join(", ")}']. Received: ${e}.`)}generateUniqueId(e=16){const t=[];if(!(void 0===e||e>0))throw new Error('If specified, the argument "length" must be a positive integer');for(let n=0;n<e;n++){const e=Math.floor(16*Math.random());t.push("0123456789abcdef"[e])}return t.join("")}getXpath(e){function t(e,n){return e?t(e.previousElementSibling,n||e.localName)+(e.localName===n?1:0):1}return function e(n){if(!n||1!==n.nodeType)return[""];const r=t(n)>1||function(e){const t=e.localName;for(;e.nextElementSibling;)if((e=e.nextElementSibling).localName===t)return!0;return!1}(n)?`${n.localName.toLowerCase()}[${t(n)}]`:n.localName.toLowerCase();return[...e(n.parentNode),r]}(e).join("/")}getAge(e){return e-this._timeOrigin}getConnectionType(){let e;if("undefined"!=typeof navigator){const t=navigator;e=t&&t.connection&&t.connection.effectiveType}return e}clone(e){return JSON.parse(JSON.stringify(e))}definedValueOrDefault(e,t){return void 0!==e?e:t}getGlobal(){if("object"==typeof globalThis)return globalThis;if("object"==typeof self)return self;throw new Error("Unable to locate globalThis or self")}getIsBeaconSupported(){return void 0!==typeof navigator&&"function"==typeof navigator.sendBeacon&&void 0!==typeof Blob}estimateObjectSize(e){const t=new Set,n=[e];let r=0;for(;n.length;){const e=n.pop();if("boolean"==typeof e)r+=4;else if("string"==typeof e)r+=2*e.length;else if("number"==typeof e)r+=8;else if(e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array)r+=e.byteLength;else if("object"==typeof e){const r=e;if(!t.has(r)){t.add(r);for(const e in r)n.push(r[e])}}}return r}}Utility._isProduction=!1;const e=Object.freeze(new Utility);const t=new class{getSchemaId(e){return`${e.namespace}.${e.name}`}isInternal(e){return e&&"sf.instrumentation"===e.namespace}makePayload(e,t,n=!0){if(!n||void 0!==e&&void 0!==t)return{schema:e,payload:t}}checkSchema(t){e.requireArgument(t,"schema","object"),e.requireArgument(t.namespace,"schema.namespace","string"),e.requireArgument(t.name,"schema.name","string"),e.requireArgument(t.pbjsSchema,"schema.pbjsSchema","object");const n=t.namespace.split(".");if(2!==n.length)throw new Error(`Schema "${this.getSchemaId(t)}" must have a namespace of the form "domain.feature".`);return{domain:n[0],feature:n[1],message:t.name}}getAnyNestedObject(e,t){return t.reduce(((n,r)=>{const i=n.nested;if(i){const e=i[r];if(e)return e}throw new Error(`Cannot locate ${t.join(".")} in schema with ID ${this.getSchemaId(e)}`)}),e.pbjsSchema)}getTypes(e){const t=this.checkSchema(e),n=this.getAnyNestedObject(e,[t.domain,t.feature]).nested;if(!n)throw new Error(`Cannot parse schema with ID ${this.getSchemaId(e)}`);return n}getType(t,n){e.requireArgument(n,"messageName","string");const r=this.getTypes(t)[n];if(!r)throw new Error(`Cannot locate message ${n} in schema with ID ${this.getSchemaId(t)}`);return r}getOptions(t,n,r){r&&e.requireArgument(n,"messageName","string");const i=this.checkSchema(t);if(!n){return this.getAnyNestedObject(t,[i.domain,i.feature]).options}const o=this.getType(t,n);if(!r)return o.options;const a=o.fields[r];if(!a){const e=this.getSchemaId(t);throw new Error(`Cannot locate field ${r} in message ${n} in schema with ID ${e}`)}return a.options}};export{LazyMapToList,t as schemaUtil,e as utility};
//# sourceMappingURL=shared.js.map
